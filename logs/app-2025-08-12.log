{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 11:32:21"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 11:32:21"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 11:32:26"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 11:58:03"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 11:58:03"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 11:58:07"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:00:39"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:00:39"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:00:43"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:01:50"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:01:50"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:01:52"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:03:30"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:03:30"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:03:31"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:04:53"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:04:53"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:04:54"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:08:15"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:08:15"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:08:17"}
{"content":{"prompt":"\nYou are an expert financial analyst. Your task is to analyze the provided Google Sheet data and generate a structured response with three distinct sections for different audiences.\n\n**Sheet Name:** Sheet1\n**Sheet Data:**\n```json\n[\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"17630\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"25396\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"28764\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×›×•×œ×œ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"112978\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™× \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"97989\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×” \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"39704\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª  \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"84489\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×ª×¤×¢×•×œ×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"48638\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— × ×§×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"572211\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"2336021\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×•×Ÿ \",\n      \"type\": \"literal\"\n    }\n  ]\n]\n```\n\n**YOUR TASK:**\nGenerate a response containing ALL THREE sections below, using the exact headings as specified.\n\n---\n\n### Section 1: User Summary\n- **Goal:** To provide a quick, high-level confirmation to the user that you've understood their financial model.\n- **Audience:** **External.** This will be displayed directly to the end-user in the chat interface. It must be brief (3-4 lines max) and non-technical.\n- **Language:** The summary needs to be written in the primary language of the Google Sheet provided.\n\n### Section 2: AI Editing & Analysis\n- **Goal:** To create a comprehensive technical guide for a future AI agent that will perform edits on this sheet.\n- **Audience:** **Internal Only.** This is a system instruction. Avoid user-facing language.\n- **CRITICAL - Spatial Layout:** Financial models have a visual and spatial structure. Tables are placed above, below, or next to each other for a reason. Your analysis MUST consider this. For example, if adding 10 rows to a \"Projects\" table will overwrite a \"Summary\" table below it, your instructions must explicitly state: \"First, select and move the 'Summary' table down by 10 rows before adding new data to the 'Projects' table.\"\n- **Process:**\n    1.  **High-Level Analysis:** First, describe the sheet's overall structure and data flow. **Crucially, detail the spatial layout by describing the relationships between key tables/blocks (e.g., \"'Projects Table' is in A5:E30, directly above the 'Summary Table' which starts at A35\").** Your analysis must be based **exclusively** on the provided sheet structure. Do not assume standard financial statement layouts if they contradict the provided data.\n    2.  **Specific Instructions:** Based on your analysis, provide a clear, actionable list of editing guidelines. Include what cells are safe to update (inputs), what cells are forbidden (formulas), and explicit warnings about preserving the spatial layout. When your instructions involve adding new rows to an existing table, you must also instruct the AI to analyze the formulas in the calculated columns of that table and replicate their logic for the newly added rows.\n\n### Section 3: Data Extraction Guidelines\n- **Goal:** To create a checklist that will guide the AI in extracting the correct data from future financial documents for this model.\n- **Audience:** **Internal Only.** This is also part of the system instructions.\n- **Content:**\n    - List the key data points to look for.\n    - Warn about potentially confusing data (e.g., \"Look for 'Net Profit attributable to shareholders', not just 'Net Profit'\").\n    - **Units of Measure:** Pay close attention to units (e.g., thousands, millions) in both the source document and the sheet, and ensure consistency.\n    - **Data Formatting:** When extracting numerical or date values, pay close attention to the formatting used in the existing sheet (e.g., currency symbols, decimal separators, date format) and instruct the AI to use the exact same format.\n    - Specify what data is irrelevant to this specific model.\n\n---\n\n**OUTPUT FORMAT:**\n\n### SUMMARY_FOR_USER ###\n(Your 3-4 line summary in the sheet's language goes here)\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n(Your detailed analysis and editing instructions go here)\n\n### DATA_EXTRACTION_GUIDELINES ###\n(Your data extraction checklist goes here)\n"},"description":"×¤×¨×•××¤×˜ ×××•×—×“ ×œ× ×™×ª×•×— ×’×™×œ×™×•×Ÿ: × ×©×œ×— ×œ××•×“×œ ×œ×™×¦×™×¨×ª ×¡×™×›×•× ×•×”×•×¨××•×ª.","direction":"UNIFIED_PROMPT","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_PROMPT","model":"gemini-2.5-pro","sheetName":"Sheet1","timestamp":"2025-08-12 12:08:50","type":"SHEET_ANALYSIS"}
{"content":{"response":"### SUMMARY_FOR_USER ###\n× ×™×ª×—×ª×™ ××ª ×”××•×“×œ ×”×¤×™× × ×¡×™ ×©×œ×š ×¢×‘×•×¨ ×§×¨×“×Ÿ × ×“×œ\"×Ÿ ×œ×ª×§×•×¤×” ×”××¡×ª×™×™××ª ×‘-31 ×‘××¨×¥ 2025. ×”××•×“×œ ××¦×™×’ × ×ª×•× ×™× ×¤×™× × ×¡×™×™× ××¨×›×–×™×™×, ×›×•×œ×œ ×¡×š ×”×”×›× ×¡×•×ª, ×¨×•×•×— ×ª×¤×¢×•×œ×™, ×¨×•×•×— × ×§×™, ×¡×š ×”×”×•×Ÿ ×•× ×ª×•× ×™ ××–×•×× ×™×. ×”× ×™×ª×•×— ×”×•×©×œ×, ×•×× ×™ ××•×›×Ÿ ×œ×¡×™×™×¢ ×‘×¢×“×›×•×Ÿ ×”××•×“×œ ××• ×‘×”×¤×§×ª ×ª×•×‘× ×•×ª × ×•×¡×¤×•×ª.\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n**1. High-Level Analysis**\n\n*   **Overall Structure:** The sheet is a simple, single-block financial summary, not a structured financial statement (P&L, Balance Sheet, etc.). It functions as a key-value list where financial metric labels are in column C and their corresponding numerical values are in column B.\n*   **Spatial Layout:** The layout is minimalistic.\n    *   **Title Block:** Cell C1 contains the model title: \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\".\n    *   **Data Block:** The core data resides in a single table-like structure spanning B4:C13. There are no adjacent, preceding, or succeeding tables or data blocks. All data is contained within this vertical list.\n*   **Data Flow:** The provided data consists exclusively of literal values. There are no formulas detected. Therefore, all numerical cells in column B are considered direct inputs.\n\n**2. Specific Instructions**\n\n*   **Safe to Update:**\n    *   **Values:** All cells in the range B4:B13 are numerical inputs and are safe to update with new data for the corresponding metric.\n    *   **Labels:** The labels in C4:C13 can be modified if a metric's definition changes, though this is less common.\n    *   **Title:** The title in C1 can be updated, for instance, to reflect a new reporting period.\n\n*   **Forbidden to Update:**\n    *   Based on the provided data, no cells contain formulas. However, as a general rule, if a cell in column B were to contain a formula (e.g., `=SUM(B4:B5)`), it must NOT be overwritten with a literal value.\n\n*   **Spatial Layout & Row Insertion:**\n    *   The model's simple vertical structure means there is no risk of overwriting adjacent data blocks.\n    *   To add a new financial metric, insert a new row below the existing data (e.g., in row 14). Place the numerical value in column B (e.g., B14) and the corresponding label in column C (e.g., C14).\n    *   There is no need to move other tables or blocks before adding rows.\n\n*   **Formula Replication:**\n    *   This model currently contains no formulas. If a user request introduces formulas into any cells (e.g., a \"Gross Margin %\" calculation), any subsequent edits that add new rows with similar data types must analyze and replicate the logic of those formulas for the new rows.\n\n### DATA_EXTRACTION_GUIDELINES ###\n**1. Key Data Points to Extract:**\n\nWhen scanning a new financial document (e.g., a quarterly report) for Kardan Real Estate, extract the following specific items. Note the exact Hebrew terminology:\n\n*   `×¡×š ×›×œ ×”×”×›× ×¡×•×ª` (Total revenues)\n*   `×¨×•×•×— ×ª×¤×¢×•×œ×™` (Operating profit)\n*   `×¨×•×•×— × ×§×™` (Net profit)\n*   `×¨×•×•×— ×›×•×œ×œ` (Total comprehensive income)\n*   `×¡×š × ×›×¡×™× ×©×•×˜×¤×™×` (Total current assets)\n*   `×¡×š ×›×œ ×”×”×•×Ÿ` (Total equity)\n*   `×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×”` (Cash and cash equivalents at end of period)\n*   `××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª` (Cash for operating activities)\n*   `××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª` (Cash from operations used for operating activities)\n\n**2. Warnings and Ambiguities:**\n\n*   **Duplicate Labels:** The term `××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª` (Cash for operating activities) appears twice in the model with different values. When extracting from a source document, seek context to differentiate these line items if they appear. If context is unavailable, flag it for user clarification.\n*   **Profit Types:** Distinguish carefully between `×¨×•×•×— × ×§×™` (Net Profit) and `×¨×•×•×— ×›×•×œ×œ` (Total Comprehensive Income). They are distinct metrics and must be extracted separately.\n*   **Potential Typo:** The label `××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª` contains a likely typo (\"××–×•×× ×™×•×\" instead of \"××–×•×× ×™×\"). When searching source documents, look for standard terms like \"Cash flow from operating activities\" or \"××–×•×× ×™× ×©× ×‘×¢×•/×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\".\n\n**3. Units of Measure:**\n\n*   Financial reports are typically presented in thousands or millions of currency units (e.g., \"All amounts in thousands of NIS\").\n*   **Action:** Before extraction, identify the unit of measure from the source document's header or footnotes. The target sheet uses raw numbers (e.g., 572211). You must convert the source data to match this format. For example, if the source states \"572,211\" and specifies units are in thousands, the number to enter in the sheet is `572211000`. If the source states \"572.2\" and units are in millions, the number is `572200000`. The current sheet's numbers appear to be raw values, so assume you need to append the correct number of zeros unless the source is also in single units.\n\n**4. Data Formatting:**\n\n*   **Numerical Data:** Extract and format numbers as plain integers with no currency symbols, commas (thousand separators), or decimal points.\n*   **Date Data:** The date is part of the title in C1. If updating the date, use the existing Hebrew format: `[Day] ×‘[Month Name] [Year]` (e.g., \"31 ×‘××¨×¥ 2025\").\n\n**5. Irrelevant Data:**\n\n*   This model is a high-level summary. Do not extract detailed breakdowns unless they match a specific line item. Irrelevant data includes: Cost of Revenue, SG&A expenses, individual asset/liability details, non-controlling interests, and Earnings Per Share (EPS). Focus exclusively on the metrics listed in section 1 of these guidelines."},"description":"×ª×©×•×‘×” ×××•×—×“×ª ××”××•×“×œ: ××›×™×œ×” ×’× ××ª ×”×¡×™×›×•× ×•×’× ××ª ×”×”×•×¨××•×ª.","direction":"UNIFIED_RESPONSE","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_RESPONSE","model":"gemini-2.5-pro","sheetName":"Sheet1","timestamp":"2025-08-12 12:09:27","type":"SHEET_ANALYSIS"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:11:08"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:11:08"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:11:10"}
{"content":{"prompt":"\nYou are an expert financial analyst. Your task is to analyze the provided Google Sheet data and generate a structured response with three distinct sections for different audiences.\n\n**Sheet Name:** Sheet1\n**Sheet Data:**\n```json\n[\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"17630\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"25396\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"28764\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×›×•×œ×œ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"112978\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™× \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"97989\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×” \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"39704\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª  \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"84489\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×ª×¤×¢×•×œ×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"48638\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— × ×§×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"572211\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"2336021\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×•×Ÿ \",\n      \"type\": \"literal\"\n    }\n  ]\n]\n```\n\n**YOUR TASK:**\nGenerate a response containing ALL THREE sections below, using the exact headings as specified.\n\n---\n\n### Section 1: User Summary\n- **Goal:** To provide a quick, high-level confirmation to the user that you've understood their financial model.\n- **Audience:** **External.** This will be displayed directly to the end-user in the chat interface. It must be brief (3-4 lines max) and non-technical.\n- **Language:** The summary needs to be written in the primary language of the Google Sheet provided.\n\n### Section 2: AI Editing & Analysis\n- **Goal:** To create a comprehensive technical guide for a future AI agent that will perform edits on this sheet.\n- **Audience:** **Internal Only.** This is a system instruction. Avoid user-facing language.\n- **CRITICAL - Spatial Layout:** Financial models have a visual and spatial structure. Tables are placed above, below, or next to each other for a reason. Your analysis MUST consider this. For example, if adding 10 rows to a \"Projects\" table will overwrite a \"Summary\" table below it, your instructions must explicitly state: \"First, select and move the 'Summary' table down by 10 rows before adding new data to the 'Projects' table.\"\n- **Process:**\n    1.  **High-Level Analysis:** First, describe the sheet's overall structure and data flow. **Crucially, detail the spatial layout by describing the relationships between key tables/blocks (e.g., \"'Projects Table' is in A5:E30, directly above the 'Summary Table' which starts at A35\").** Your analysis must be based **exclusively** on the provided sheet structure. Do not assume standard financial statement layouts if they contradict the provided data.\n    2.  **Specific Instructions:** Based on your analysis, provide a clear, actionable list of editing guidelines. Include what cells are safe to update (inputs), what cells are forbidden (formulas), and explicit warnings about preserving the spatial layout. When your instructions involve adding new rows to an existing table, you must also instruct the AI to analyze the formulas in the calculated columns of that table and replicate their logic for the newly added rows.\n\n### Section 3: Data Extraction Guidelines\n- **Goal:** To create a checklist that will guide the AI in extracting the correct data from future financial documents for this model.\n- **Audience:** **Internal Only.** This is also part of the system instructions.\n- **Content:**\n    - List the key data points to look for.\n    - Warn about potentially confusing data (e.g., \"Look for 'Net Profit attributable to shareholders', not just 'Net Profit'\").\n    - **Units of Measure:** Pay close attention to units (e.g., thousands, millions) in both the source document and the sheet, and ensure consistency.\n    - **Data Formatting:** When extracting numerical or date values, pay close attention to the formatting used in the existing sheet (e.g., currency symbols, decimal separators, date format) and instruct the AI to use the exact same format.\n    - Specify what data is irrelevant to this specific model.\n\n---\n\n**OUTPUT FORMAT:**\n\n### SUMMARY_FOR_USER ###\n(Your 3-4 line summary in the sheet's language goes here)\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n(Your detailed analysis and editing instructions go here)\n\n### DATA_EXTRACTION_GUIDELINES ###\n(Your data extraction checklist goes here)\n"},"description":"×¤×¨×•××¤×˜ ×××•×—×“ ×œ× ×™×ª×•×— ×’×™×œ×™×•×Ÿ: × ×©×œ×— ×œ××•×“×œ ×œ×™×¦×™×¨×ª ×¡×™×›×•× ×•×”×•×¨××•×ª.","direction":"UNIFIED_PROMPT","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_PROMPT","model":"gemini-2.5-pro","sheetName":"Sheet1","timestamp":"2025-08-12 12:11:26","type":"SHEET_ANALYSIS"}
{"content":{"response":"### SUMMARY_FOR_USER ###\n×©×œ×•×, × ×™×ª×—×ª×™ ××ª ××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ ×œ×ª××¨×™×š 31 ×‘××¨×¥ 2025. ×”××•×“×œ ××¡×›× × ×ª×•× ×™× ×¤×™× × ×¡×™×™× ××¨×›×–×™×™×, ×›×•×œ×œ ×¡×š ×”×›× ×¡×•×ª, ×¨×•×•×—×™× ×©×•× ×™×, ×¡×š ×”×”×•×Ÿ ×•× ×ª×•× ×™ ××–×•×× ×™×. ×”× ×ª×•× ×™× ×××•×¨×’× ×™× ×›×¨×©×™××” ×¤×©×•×˜×” ×©×œ ××“×“×™× ×¢×™×§×¨×™×™× ×•×¢×¨×›×™×”×.\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n**1. High-Level Analysis**\n\n*   **Sheet Purpose:** The sheet, titled \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\" (Kardan Real Estate Model March 31, 2025), serves as a high-level summary or input dashboard for a financial model. It is not a structured financial statement (P&L, Balance Sheet, etc.).\n*   **Structure & Spatial Layout:** The data is structured as a simple two-column key-value list.\n    *   The model title is located at cell `C1`.\n    *   The main data block occupies the range `B4:C13`.\n    *   Column `C` contains the descriptive labels (in Hebrew).\n    *   Column `B` contains the corresponding numerical values.\n    *   There are no formulas or calculations visible in the provided data; all values appear to be hard-coded inputs.\n    *   The layout is linear and vertical. There are no adjacent tables or data blocks that would create spatial conflicts based on the provided data.\n\n**2. Specific Instructions**\n\n*   **Safe-to-Edit Cells (Inputs):** The numerical values in the range `B4:B13` are considered inputs and are safe to update with new data.\n*   **Forbidden-to-Edit Cells (Structure):** Do not modify the labels in column `C` (`C4:C13`) unless specifically instructed to change the model's structure. Do not edit the title in `C1`.\n*   **Adding/Deleting Data:**\n    *   To update the existing model with new values for the same line items, simply overwrite the values in column `B`.\n    *   If a new line item needs to be added, insert a new row within the `B4:C13` range. This will shift the lower rows down and preserve the list format. For example, to add a new item after \"×¨×•×•×— ×ª×¤×¢×•×œ×™\" (Operating profit) at row 10, insert a new row at row 11.\n    *   **WARNING:** Do not add new data blocks or tables below the existing data (e.g., starting at row 15) without first verifying there is no other data further down the sheet that could be overwritten. The provided data is only a partial snapshot.\n*   **Formula Replication:** The current sheet does not contain formulas. If this model were to be expanded with formulas (e.g., calculating a ratio in column D), any instruction to add new rows of data must be paired with an instruction to analyze and replicate the corresponding formulas for the newly added rows.\n\n### DATA_EXTRACTION_GUIDELINES ###\nThis checklist is for extracting data from source financial reports (e.g., Kardan Real Estate's quarterly or annual reports) to update this model.\n\n**Key Data Points to Extract (Search for these Hebrew terms):**\n\n*   **×¡×š ×›×œ ×”×”×›× ×¡×•×ª:** Total Revenues / Sales\n*   **×¨×•×•×— ×ª×¤×¢×•×œ×™:** Operating Profit\n*   **×¨×•×•×— × ×§×™:** Net Profit\n*   **×¨×•×•×— ×›×•×œ×œ:** Total Comprehensive Income\n*   **×¡×š ×›×œ ×”×”×•×Ÿ:** Total Equity\n*   **×¡×š × ×›×¡×™× ×©×•×˜×¤×™×:** Total Current Assets\n*   **×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×”:** Cash and Cash Equivalents at end of period\n*   **××–×•×× ×™× ××¤×¢×™×œ×•×ª ×©×•×˜×¤×ª:** Cash from Operating Activities\n\n**Potential Ambiguities & Warnings:**\n\n*   **Profit Types:** Be precise. Distinguish between \"Operating Profit\" (`×¨×•×•×— ×ª×¤×¢×•×œ×™`), \"Net Profit\" (`×¨×•×•×— × ×§×™`), and \"Total Comprehensive Income\" (`×¨×•×•×— ×›×•×œ×œ`). They are distinct figures.\n*   **Cash Flow Items:** The sheet lists \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash for current operations) twice with different values, and \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash from operations used for current activities). When updating, seek the exact line item from the source's Cash Flow Statement. If the labels in the source document are different, flag it for review rather than making an assumption. The most standard term to look for is \"×ª×–×¨×™× ××–×•×× ×™× ××¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash flow from operating activities).\n*   **Total Equity:** Ensure you are extracting \"Total Equity\" and not \"Total Assets\" or \"Total Liabilities and Equity\".\n\n**Units of Measure & Formatting:**\n\n*   **Units:** Financial reports are often presented \"in thousands of NIS\" or \"in millions of NIS\". The sheet's values (e.g., `572211` for revenue) appear to be raw numbers (i.e., not in thousands). Verify the units in the source document. If the source says \"All numbers are in thousands of NIS,\" you must multiply the number from the report by 1,000 before entering it into the sheet (e.g., a report value of `572` would become `572000`).\n*   **Data Formatting:** All numerical data in the sheet is formatted as plain integers without currency symbols or thousands separators (e.g., `2336021`). When extracting data, strip any formatting (e.g., \"NIS\", \"$\", \",\", \".\") and input only the integer value.\n\n**Irrelevant Data for this Model:**\n\n*   Detailed breakdowns of revenues, expenses, assets, or liabilities.\n*   Non-financial data (e.g., number of employees, square meters sold).\n*   Data attributable to non-controlling interests (unless specified).\n*   Per-share data (EPS, etc.)."},"description":"×ª×©×•×‘×” ×××•×—×“×ª ××”××•×“×œ: ××›×™×œ×” ×’× ××ª ×”×¡×™×›×•× ×•×’× ××ª ×”×”×•×¨××•×ª.","direction":"UNIFIED_RESPONSE","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_RESPONSE","model":"gemini-2.5-pro","sheetName":"Sheet1","timestamp":"2025-08-12 12:12:01","type":"SHEET_ANALYSIS"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:15:33"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:15:33"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:15:34"}
{"content":{"prompt":"\nYou are an expert financial analyst. Your task is to analyze the provided Google Sheet data and generate a structured response with three distinct sections for different audiences.\n\n**Sheet Name:** Sheet1\n**Sheet Data:**\n```json\n[\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"17630\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"25396\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"28764\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×›×•×œ×œ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"112978\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™× \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"97989\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×” \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"39704\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª  \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"84489\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×ª×¤×¢×•×œ×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"48638\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— × ×§×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"572211\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"2336021\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×•×Ÿ \",\n      \"type\": \"literal\"\n    }\n  ]\n]\n```\n\n**YOUR TASK:**\nGenerate a response containing ALL THREE sections below, using the exact headings as specified.\n\n---\n\n### Section 1: User Summary\n- **Goal:** To provide a quick, high-level confirmation to the user that you've understood their financial model.\n- **Audience:** **External.** This will be displayed directly to the end-user in the chat interface. It must be brief (3-4 lines max) and non-technical.\n- **Language:** The summary needs to be written in the primary language of the Google Sheet provided.\n\n### Section 2: AI Editing & Analysis\n- **Goal:** To create a comprehensive technical guide for a future AI agent that will perform edits on this sheet.\n- **Audience:** **Internal Only.** This is a system instruction. Avoid user-facing language.\n- **CRITICAL - Spatial Layout:** Financial models have a visual and spatial structure. Tables are placed above, below, or next to each other for a reason. Your analysis MUST consider this. For example, if adding 10 rows to a \"Projects\" table will overwrite a \"Summary\" table below it, your instructions must explicitly state: \"First, select and move the 'Summary' table down by 10 rows before adding new data to the 'Projects' table.\"\n- **Process:**\n    1.  **High-Level Analysis:** First, describe the sheet's overall structure and data flow. **Crucially, detail the spatial layout by describing the relationships between key tables/blocks (e.g., \"'Projects Table' is in A5:E30, directly above the 'Summary Table' which starts at A35\").** Your analysis must be based **exclusively** on the provided sheet structure. Do not assume standard financial statement layouts if they contradict the provided data.\n    2.  **Specific Instructions:** Based on your analysis, provide a clear, actionable list of editing guidelines. Include what cells are safe to update (inputs), what cells are forbidden (formulas), and explicit warnings about preserving the spatial layout. When your instructions involve adding new rows to an existing table, you must also instruct the AI to analyze the formulas in the calculated columns of that table and replicate their logic for the newly added rows.\n\n### Section 3: Data Extraction Guidelines\n- **Goal:** To create a checklist that will guide the AI in extracting the correct data from future financial documents for this model.\n- **Audience:** **Internal Only.** This is also part of the system instructions.\n- **Content:**\n    - List the key data points to look for.\n    - Warn about potentially confusing data (e.g., \"Look for 'Net Profit attributable to shareholders', not just 'Net Profit'\").\n    - **Units of Measure:** Pay close attention to units (e.g., thousands, millions) in both the source document and the sheet, and ensure consistency.\n    - **Data Formatting:** When extracting numerical or date values, pay close attention to the formatting used in the existing sheet (e.g., currency symbols, decimal separators, date format) and instruct the AI to use the exact same format.\n    - Specify what data is irrelevant to this specific model.\n\n---\n\n**OUTPUT FORMAT:**\n\n### SUMMARY_FOR_USER ###\n(Your 3-4 line summary in the sheet's language goes here)\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n(Your detailed analysis and editing instructions go here)\n\n### DATA_EXTRACTION_GUIDELINES ###\n(Your data extraction checklist goes here)\n"},"description":"×¤×¨×•××¤×˜ ×××•×—×“ ×œ× ×™×ª×•×— ×’×™×œ×™×•×Ÿ: × ×©×œ×— ×œ××•×“×œ ×œ×™×¦×™×¨×ª ×¡×™×›×•× ×•×”×•×¨××•×ª.","direction":"UNIFIED_PROMPT","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_PROMPT","model":"gemini-2.5-pro","sheetName":"Sheet1","timestamp":"2025-08-12 12:16:00","type":"SHEET_ANALYSIS"}
{"content":{"response":"### SUMMARY_FOR_USER ###\n× ×™×ª×—×ª×™ ××ª ×”××•×“×œ ×”×¤×™× × ×¡×™ ×©×œ ×§×¨×“×Ÿ × ×“×œ\"×Ÿ ×œ×ª××¨×™×š 31 ×‘××¨×¥ 2025. ×”××•×“×œ ××•×¨×›×‘ ××¨×©×™××” ×©×œ × ×ª×•× ×™× ×¤×™× × ×¡×™×™× ××¨×›×–×™×™×, ×›×’×•×Ÿ ×¡×š ×”×”×›× ×¡×•×ª, ×¨×•×•×— × ×§×™, ×¡×š ×”×”×•×Ÿ ×•× ×ª×•× ×™ ××–×•×× ×™×. ×”× ×ª×•× ×™× ×××•×¨×’× ×™× ×‘××‘× ×” ×¤×©×•×˜ ×•×‘×¨×•×¨ ×œ×¦×•×¨×š × ×™×ª×•×— ×•×”×¢×¨×›×”.\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n**1. High-Level Analysis**\n\n*   **Sheet Structure:** The sheet \"Sheet1\" contains a single, simple block of financial data. The model title \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\" is located in cell C1.\n*   **Data Layout:** The core data is a vertical list of key financial metrics presented as label-value pairs. Labels are in column C (range C4:C13) and their corresponding numerical values are in column B (range B4:B13). All values are hard-coded literals; there are no formulas in the sheet. Column A is intentionally left blank.\n*   **Spatial Layout:** The model consists of only one data block (B4:C13). There are no other tables, charts, or data summaries located elsewhere on the sheet (e.g., to the right or below this block). This lack of other components means there is no risk of spatial conflict or data overwriting when inserting or deleting rows within the primary data list.\n\n**2. Specific Instructions**\n\n*   **Safe Cells to Edit (Inputs):** The numerical values in column B (B4:B13) are the model's inputs. These cells are designed to be updated with new figures. It is safe to directly overwrite the values in this range.\n*   **Forbidden Cells to Edit (Structure/Labels):**\n    *   Do not edit the labels in column C unless specifically instructed to correct a typo or rename a metric. The integrity of these labels is crucial for identifying the data points.\n    *   Do not edit the title in cell C1.\n    *   Do not place any data in column A.\n*   **Adding/Deleting Rows:**\n    *   **Adding:** To add a new financial metric, insert a new row anywhere between row 4 and row 14. Place the new metric's Hebrew label in column C and its numerical value in column B.\n    *   **Deleting:** To remove a metric, delete the entire row.\n    *   **Spatial Impact:** Because the sheet contains only this single vertical list, inserting or deleting rows is a safe operation. It will simply shift the subsequent rows down or up without overwriting any other elements.\n*   **Formula Replication:** The sheet contains no formulas. When adding a new row, no formula replication is necessary. Simply input the new label and value as literals.\n\n### DATA_EXTRACTION_GUIDELINES ###\n**Checklist for Data Extraction:**\n\n*   **Key Data Points to Extract:** Search the source financial documents for the following specific metrics. Match them to the Hebrew labels provided.\n    *   `×¡×š ×›×œ ×”×”×›× ×¡×•×ª`: Total Revenue / Total Income\n    *   `×¨×•×•×— ×ª×¤×¢×•×œ×™`: Operating Profit / Operating Income\n    *   `×¨×•×•×— × ×§×™`: Net Profit / Net Income (Note: Prioritize \"Net profit attributable to shareholders\" if available).\n    *   `×¨×•×•×— ×›×•×œ×œ`: Total Comprehensive Income\n    *   `×¡×š × ×›×¡×™× ×©×•×˜×¤×™×`: Total Current Assets\n    *   `×¡×š ×›×œ ×”×”×•×Ÿ`: Total Equity\n    *   `×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×”`: Cash and Cash Equivalents at end of period\n    *   `××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª`: Cash for current operations (Note: The model lists this twice. Check if the source document has two distinct line items with this name or a similar theme. If so, extract both.)\n    *   `××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª`: Cash from operations used for current activities. (Note the typo `××–×•×× ×™×•×` in the sheet. The source document will likely say `××–×•×× ×™×`. Be prepared to match both variations.)\n\n*   **Potential Confusion / Disambiguation:**\n    *   Carefully distinguish between **Net Profit (`×¨×•×•×— × ×§×™`)**, **Operating Profit (`×¨×•×•×— ×ª×¤×¢×•×œ×™`)**, and **Total Comprehensive Income (`×¨×•×•×— ×›×•×œ×œ`)**. They are distinct metrics.\n    *   Do not confuse **Total Equity (`×¡×š ×›×œ ×”×”×•×Ÿ`)** with **Total Assets** or **Total Current Assets (`×¡×š × ×›×¡×™× ×©×•×˜×¤×™×`)**.\n\n*   **Units of Measure:**\n    *   The financial model uses whole numbers (e.g., `572211`). Source documents (e.g., quarterly reports) often report figures \"in thousands\" or \"in millions\" of a currency (e.g., ILS, USD).\n    *   **CRITICAL:** Before extracting a number, check the page headers, footers, and table notes for the unit of measure. If the source says a value is in thousands, you must multiply it by 1,000 before inputting it into the model (e.g., a reported value of \"572,211\" in thousands should be treated as `572211000`). Based on the provided sheet, it's likely the intended unit is already in thousands. Clarify this if possible, but assume consistency is key. Extract the value that matches the magnitude of the existing figures.\n\n*   **Data Formatting:**\n    *   **Numbers:** The model requires plain integer values. When extracting a number like \"â‚ª572,211.00\", you must strip the currency symbol (â‚ª), the comma separator, and any decimal places to format it as `572211`.\n    *   **Dates:** Not applicable for this model's inputs, but if the model date in C1 needs updating, use the format \"DD ×‘MMMM YYYY\" (e.g., \"31 ×‘××¨×¥ 2025\").\n\n*   **Irrelevant Data:**\n    *   Ignore detailed breakdowns of revenue or expenses (e.g., Cost of Goods Sold, SG&A, R&D).\n    *   Ignore individual asset or liability line items (e.g., Accounts Receivable, Long-term Debt), unless they are needed to manually calculate one of the required totals listed above.\n    *   Ignore non-financial data, management commentary, and notes to the financial statements unless they are required to clarify a unit of measure or the definition of a key metric."},"description":"×ª×©×•×‘×” ×××•×—×“×ª ××”××•×“×œ: ××›×™×œ×” ×’× ××ª ×”×¡×™×›×•× ×•×’× ××ª ×”×”×•×¨××•×ª.","direction":"UNIFIED_RESPONSE","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_RESPONSE","model":"gemini-2.5-pro","sheetName":"Sheet1","timestamp":"2025-08-12 12:16:42","type":"SHEET_ANALYSIS"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:22:01"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:22:01"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:22:03"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:23:59"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:23:59"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:24:01"}
{"content":{"prompt":"\nYou are an expert financial analyst. Your task is to analyze the provided Google Sheet data and generate a structured response with three distinct sections for different audiences.\n\n**Sheet Name:** Sheet1\n**Sheet Data:**\n```json\n[\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"17630\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"25396\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"28764\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×›×•×œ×œ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"112978\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™× \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"97989\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×” \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"39704\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª  \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"84489\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×ª×¤×¢×•×œ×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"48638\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— × ×§×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"572211\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"2336021\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×•×Ÿ \",\n      \"type\": \"literal\"\n    }\n  ]\n]\n```\n\n**YOUR TASK:**\nGenerate a response containing ALL THREE sections below, using the exact headings as specified.\n\n---\n\n### Section 1: User Summary\n- **Goal:** To provide a quick, high-level confirmation to the user that you've understood their financial model.\n- **Audience:** **External.** This will be displayed directly to the end-user in the chat interface. It must be brief (3-4 lines max) and non-technical.\n- **Language:** The summary needs to be written in the primary language of the Google Sheet provided.\n\n### Section 2: AI Editing & Analysis\n- **Goal:** To create a comprehensive technical guide for a future AI agent that will perform edits on this sheet.\n- **Audience:** **Internal Only.** This is a system instruction. Avoid user-facing language.\n- **CRITICAL - Spatial Layout:** Financial models have a visual and spatial structure. Tables are placed above, below, or next to each other for a reason. Your analysis MUST consider this. For example, if adding 10 rows to a \"Projects\" table will overwrite a \"Summary\" table below it, your instructions must explicitly state: \"First, select and move the 'Summary' table down by 10 rows before adding new data to the 'Projects' table.\"\n- **Process:**\n    1.  **High-Level Analysis:** First, describe the sheet's overall structure and data flow. **Crucially, detail the spatial layout by describing the relationships between key tables/blocks (e.g., \"'Projects Table' is in A5:E30, directly above the 'Summary Table' which starts at A35\").** Your analysis must be based **exclusively** on the provided sheet structure. Do not assume standard financial statement layouts if they contradict the provided data.\n    2.  **Specific Instructions:** Based on your analysis, provide a clear, actionable list of editing guidelines. Include what cells are safe to update (inputs), what cells are forbidden (formulas), and explicit warnings about preserving the spatial layout. When your instructions involve adding new rows to an existing table, you must also instruct the AI to analyze the formulas in the calculated columns of that table and replicate their logic for the newly added rows.\n\n### Section 3: Data Extraction Guidelines\n- **Goal:** To create a checklist that will guide the AI in extracting the correct data from future financial documents for this model.\n- **Audience:** **Internal Only.** This is also part of the system instructions.\n- **Content:**\n    - List the key data points to look for.\n    - Warn about potentially confusing data (e.g., \"Look for 'Net Profit attributable to shareholders', not just 'Net Profit'\").\n    - **Units of Measure:** Pay close attention to units (e.g., thousands, millions) in both the source document and the sheet, and ensure consistency.\n    - **Data Formatting:** When extracting numerical or date values, pay close attention to the formatting used in the existing sheet (e.g., currency symbols, decimal separators, date format) and instruct the AI to use the exact same format.\n    - Specify what data is irrelevant to this specific model.\n\n---\n\n**OUTPUT FORMAT:**\n\n### SUMMARY_FOR_USER ###\n(Your 3-4 line summary in the sheet's language goes here)\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n(Your detailed analysis and editing instructions go here)\n\n### DATA_EXTRACTION_GUIDELINES ###\n(Your data extraction checklist goes here)\n"},"description":"×¤×¨×•××¤×˜ ×××•×—×“ ×œ× ×™×ª×•×— ×’×™×œ×™×•×Ÿ: × ×©×œ×— ×œ××•×“×œ ×œ×™×¦×™×¨×ª ×¡×™×›×•× ×•×”×•×¨××•×ª.","direction":"UNIFIED_PROMPT","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_PROMPT","model":"gemini-2.5-pro","sheetName":"Sheet1","timestamp":"2025-08-12 12:24:23","type":"SHEET_ANALYSIS"}
{"content":{"response":"### SUMMARY_FOR_USER ###\n×”×‘× ×ª×™ ××ª ×”××•×“×œ ×”×¤×™× × ×¡×™ ×©×œ×š ×¢×‘×•×¨ ×§×¨×“×Ÿ × ×“×œ\"×Ÿ ×œ×ª××¨×™×š 31 ×‘××¨×¥ 2025. ×”××•×“×œ ××¨×›×– ×¨×©×™××ª × ×ª×•× ×™× ×¤×™× × ×¡×™×™× ×¢×™×§×¨×™×™×, ×›×’×•×Ÿ ×¡×š ×”×›× ×¡×•×ª, ××“×“×™ ×¨×•×•×— ×©×•× ×™×, ×•× ×ª×•× ×™ ××–×•×× ×™× ×•×”×•×Ÿ. ×× ×™ ××•×›×Ÿ ×œ×¡×™×™×¢ ×‘×¢×“×›×•×Ÿ ×”× ×ª×•× ×™× ××• ×‘× ×™×ª×•×—×.\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n**1. High-Level Analysis**\n\n*   **Sheet Name:** Sheet1\n*   **Overall Structure:** The sheet is a simple, static data repository, not a dynamic financial model. It consists of a single block of data where Column B contains numerical values and Column C contains the corresponding Hebrew labels. There are no formulas; all cell values are literals.\n*   **Spatial Layout:** The primary data block is located in the range **B4:C13**. A title for the model, \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\", is located in cell **C1**. The sheet contains no other data blocks, tables, or charts. The layout is vertical and sparse, with empty rows and columns surrounding the main data block.\n*   **Data Flow:** There is no data flow or inter-cell dependency. The sheet acts as a list of key-value pairs for manual input and review.\n\n**2. Specific Editing Instructions**\n\n*   **Safe Cells to Update:**\n    *   **Values:** The numerical values in the range **B4:B13** are intended as inputs. These cells can be safely overwritten with updated financial data.\n    *   **Title:** The model title in cell **C1** can be updated to reflect a new entity or reporting date.\n\n*   **Forbidden Actions:**\n    *   Do not introduce formulas unless explicitly instructed. The purpose of this sheet is static data storage.\n    *   Do not alter the two-column structure. All numerical values must reside in Column B, and their corresponding labels must be in Column C. Do not use Column A for data.\n\n*   **Adding/Deleting Rows (Data Points):**\n    *   **Adding:** To add a new financial metric, insert a new row within or at the end of the data block (e.g., in row 14). Place the numerical value in column B and the Hebrew label in column C. As there are no other elements on the sheet, there is no risk of overwriting data.\n    *   **Deleting:** To remove a financial metric, delete the entire row (e.g., select row 8 and delete) to ensure both the value and its label are removed, maintaining the structural integrity.\n\n*   **Formula Replication:**\n    *   Not applicable. No formulas were detected in the provided sheet data. If adding new rows, no formula replication is necessary.\n\n### DATA_EXTRACTION_GUIDELINES ###\n**Objective:** To extract key financial data from source documents (e.g., quarterly/annual reports) to populate this model.\n\n**Checklist:**\n\n1.  **Key Data Points to Extract:**\n    *   **Total Revenue:** `×¡×š ×›×œ ×”×”×›× ×¡×•×ª`\n    *   **Operating Profit:** `×¨×•×•×— ×ª×¤×¢×•×œ×™`\n    *   **Net Profit:** `×¨×•×•×— × ×§×™`\n    *   **Total Comprehensive Income:** `×¨×•×•×— ×›×•×œ×œ`\n    *   **Total Current Assets:** `×¡×š × ×›×¡×™× ×©×•×˜×¤×™×`\n    *   **Total Equity:** `×¡×š ×›×œ ×”×”×•×Ÿ`\n    *   **Ending Cash and Cash Equivalents:** `×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×”` (from Balance Sheet)\n    *   **Cash for/from operating activities:** Look for lines matching `××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª` and `××–×•×× ×™× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª` (from Statement of Cash Flows).\n\n2.  **Warnings & Disambiguation:**\n    *   **Profit Hierarchy:** Financial reports contain multiple profit figures. Differentiate carefully. Do not confuse `Net Profit` with `Gross Profit` or `Operating Profit`. `Total Comprehensive Income` (`×¨×•×•×— ×›×•×œ×œ`) is often a separate line item from `Net Profit`.\n    *   **Ambiguous Cash Items:** The model lists \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" twice. When extracting from a source report, check if there are two distinct line items with this name or similar concepts. If not, populate one and query for clarification on the second. Note that \"××–×•×× ×™× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" refers to cash *used in* operating activities (a cash outflow).\n\n3.  **Units of Measure:**\n    *   **Source Documents:** Financial reports are typically presented in thousands or millions (e.g., ××œ×¤×™ ×©\"×—).\n    *   **Sheet Requirement:** The model requires the full numerical value. **Action:** If a report states a value is \"572,211\" and the unit is \"thousands of NIS\", you must enter `572211` into the sheet. Strip all currency symbols and separators.\n\n4.  **Data Formatting:**\n    *   **Numbers:** All numerical values must be entered as unformatted integers (e.g., `48638`). Do not use commas, decimals (unless the source is a non-integer), or currency symbols.\n    *   **Dates:** The date in the title (C1) must follow the Hebrew format \"DD ×‘MMMM YYYY\" (e.g., `31 ×‘××¨×¥ 2025`).\n\n5.  **Irrelevant Data for this Model:**\n    *   Ignore detailed breakdowns of revenues, expenses (COGS, SG&A), assets, or liabilities.\n    *   Ignore cash flows from investing and financing activities.\n    *   Focus only on the high-level summary figures listed in point #1."},"description":"×ª×©×•×‘×” ×××•×—×“×ª ××”××•×“×œ: ××›×™×œ×” ×’× ××ª ×”×¡×™×›×•× ×•×’× ××ª ×”×”×•×¨××•×ª.","direction":"UNIFIED_RESPONSE","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_RESPONSE","model":"gemini-2.5-pro","sheetName":"Sheet1","timestamp":"2025-08-12 12:25:07","type":"SHEET_ANALYSIS"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:35:46"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:35:46"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:35:48"}
{"content":{"prompt":"\nYou are an expert financial analyst. Your task is to analyze the provided Google Sheet data and generate a structured response with three distinct sections for different audiences.\n\n**Sheet Name:** Sheet1\n**Sheet Data:**\n```json\n[\n  [\n    {\n      \"value\": \"×‘×¨×§ ×¡×ª×•××§×™\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"×‘×¨×§ ×¡×ª×•××§×™ ××¡ 2\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"3\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"17630\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"25396\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"28764\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×›×•×œ×œ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"112978\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™× \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"97989\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×” \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"39704\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª  \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"84489\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×ª×¤×¢×•×œ×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"48638\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— × ×§×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"572211\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"2336021\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×•×Ÿ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"336382\",\n      \"formula\": \"=AVERAGE(B4:B13)\",\n      \"type\": \"formula\"\n    }\n  ]\n]\n```\n\n**YOUR TASK:**\nGenerate a response containing ALL THREE sections below, using the exact headings as specified.\n\n---\n\n### Section 1: User Summary\n- **Goal:** To provide a quick, high-level confirmation to the user that you've understood their financial model.\n- **Audience:** **External.** This will be displayed directly to the end-user in the chat interface. It must be brief (3-4 lines max) and non-technical.\n- **Language:** The summary needs to be written in the primary language of the Google Sheet provided.\n\n### Section 2: AI Editing & Analysis\n- **Goal:** To create a comprehensive technical guide for a future AI agent that will perform edits on this sheet.\n- **Audience:** **Internal Only.** This is a system instruction. Avoid user-facing language.\n- **CRITICAL - Spatial Layout:** Financial models have a visual and spatial structure. Tables are placed above, below, or next to each other for a reason. Your analysis MUST consider this. For example, if adding 10 rows to a \"Projects\" table will overwrite a \"Summary\" table below it, your instructions must explicitly state: \"First, select and move the 'Summary' table down by 10 rows before adding new data to the 'Projects' table.\"\n- **Process:**\n    1.  **High-Level Analysis:** First, describe the sheet's overall structure and data flow. **Crucially, detail the spatial layout by describing the relationships between key tables/blocks (e.g., \"'Projects Table' is in A5:E30, directly above the 'Summary Table' which starts at A35\").** Your analysis must be based **exclusively** on the provided sheet structure. Do not assume standard financial statement layouts if they contradict the provided data.\n    2.  **Specific Instructions:** Based on your analysis, provide a clear, actionable list of editing guidelines. Include what cells are safe to update (inputs), what cells are forbidden (formulas), and explicit warnings about preserving the spatial layout. When your instructions involve adding new rows to an existing table, you must also instruct the AI to analyze the formulas in the calculated columns of that table and replicate their logic for the newly added rows.\n\n### Section 3: Data Extraction Guidelines\n- **Goal:** To create a checklist that will guide the AI in extracting the correct data from future financial documents for this model.\n- **Audience:** **Internal Only.** This is also part of the system instructions.\n- **Content:**\n    - List the key data points to look for.\n    - Warn about potentially confusing data (e.g., \"Look for 'Net Profit attributable to shareholders', not just 'Net Profit'\").\n    - **Units of Measure:** Pay close attention to units (e.g., thousands, millions) in both the source document and the sheet, and ensure consistency.\n    - **Data Formatting:** When extracting numerical or date values, pay close attention to the formatting used in the existing sheet (e.g., currency symbols, decimal separators, date format) and instruct the AI to use the exact same format.\n    - Specify what data is irrelevant to this specific model.\n\n---\n\n**OUTPUT FORMAT:**\n\n### SUMMARY_FOR_USER ###\n(Your 3-4 line summary in the sheet's language goes here)\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n(Your detailed analysis and editing instructions go here)\n\n### DATA_EXTRACTION_GUIDELINES ###\n(Your data extraction checklist goes here)\n"},"description":"×¤×¨×•××¤×˜ ×××•×—×“ ×œ× ×™×ª×•×— ×’×™×œ×™×•×Ÿ: × ×©×œ×— ×œ××•×“×œ ×œ×™×¦×™×¨×ª ×¡×™×›×•× ×•×”×•×¨××•×ª.","direction":"UNIFIED_PROMPT","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_PROMPT","model":"gemini-2.5-flash","sheetName":"Sheet1","timestamp":"2025-08-12 12:36:03","type":"SHEET_ANALYSIS"}
{"content":{"response":"### SUMMARY_FOR_USER ###\n×”×’×™×œ×™×•×Ÿ ××¦×™×’ ××•×“×œ ×¤×™× × ×¡×™ ×©×œ \"×§×¨×“×Ÿ × ×“×œ×Ÿ\" ×œ×ª××¨×™×š 31 ×‘××¨×¥ 2025, ×›×¤×™ ×©×”×•×›×Ÿ ×¢×œ ×™×“×™ ×‘×¨×§ ×¡×ª×•××§×™. ×”×•× ×›×•×œ×œ × ×ª×•× ×™ ××¤×ª×— ×¤×™× × ×¡×™×™× ×›××• ××–×•×× ×™×, × ×›×¡×™×, ×”×›× ×¡×•×ª ×•×¨×•×•×—×™×, ×•×›×Ÿ ×—×™×©×•×‘ ×××•×¦×¢ ×©×œ × ×ª×•× ×™× ××œ×•.\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n**High-Level Analysis & Spatial Layout:**\nThe sheet's primary purpose is to display a set of key financial metrics and a derived average.\n*   Rows 1-3 serve as a header/metadata block, containing the model name, date, and preparer's name.\n*   The main \"Key Financial Metrics\" data block is located in cells B4:C13. Column B contains numerical input values, and Column C contains the corresponding Hebrew descriptions.\n*   A calculated cell, D15, contains the average of the numerical values from the \"Key Financial Metrics\" block (`=AVERAGE(B4:B13)`).\n*   There is a single blank row (Row 14) positioned directly between the \"Key Financial Metrics\" block (ending at C13) and the calculated cell (D15). This blank row acts as a visual separator. The calculation in D15 is spatially distinct, located below and to the right of the main data block.\n\n**Specific Instructions:**\n1.  **Input Cells (Safe to Update):**\n    *   Cells B4:B13 are designated for numerical input of financial metrics. These values can be updated as new data becomes available.\n    *   Cells C4:C13 contain the textual descriptions for the metrics. These can be edited for clarity or accuracy if the corresponding financial item is the same but the label needs refinement.\n2.  **Calculated Cells (Forbidden to Directly Edit):**\n    *   Cell D15 contains a formula (`=AVERAGE(B4:B13)`). This cell must NOT be directly edited or overwritten. Its value is derived.\n3.  **Preserving Spatial Layout and Expanding Data:**\n    *   If new financial metrics need to be added to the model, rows should be inserted *immediately below* the last existing metric (currently Row 13), i.e., at Row 14. This will push down the original Row 14 (blank) and Row 15 (formula).\n    *   **Crucially:** When new rows are inserted (e.g., at the new Row 14, pushing existing data down), the formula in D15 (`=AVERAGE(B4:B13)`) *will not automatically expand its range* to include the newly added rows.\n    *   **Mandatory Action for AI:** After inserting new rows, the AI *must* update the formula in D15 to reflect the expanded range. For example, if 2 new rows are added, the formula must be updated from `=AVERAGE(B4:B13)` to `=AVERAGE(B4:B15)`. The AI must determine the new end row for the average calculation based on the total number of metrics in column B.\n    *   The blank row (currently Row 14) must be maintained. If inserting rows consumes the original blank row, ensure a new blank row is inserted to maintain a visual separation between the main data block and the summary calculations.\n4.  **No Internal Formula Replication:** The \"Key Financial Metrics\" block (B4:C13) does not contain internal calculated columns requiring formula replication. Values in column B are direct inputs.\n\n### DATA_EXTRACTION_GUIDELINES ###\n1.  **Key Data Points to Extract:**\n    *   \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash for operating activities): Look for \"Cash from Operations,\" \"Operating Cash Flow,\" or similar.\n    *   \"×¨×•×•×— ×›×•×œ×œ\" (Total profit): Look for \"Gross Profit,\" \"Total Profit,\" or \"Comprehensive Income.\"\n    *   \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™×\" (Total current assets): Look for \"Total Current Assets.\"\n    *   \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×”\" (Cash and cash equivalents at end of period): Look for \"Cash and Cash Equivalents, End of Period,\" \"Closing Cash Balance.\"\n    *   \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash used in operating activities): Look for \"Cash Used in Operating Activities\" or \"Net Cash Used in Operating Activities.\"\n    *   \"×¨×•×•×— ×ª×¤×¢×•×œ×™\" (Operating profit): Look for \"Operating Income,\" \"EBIT (Earnings Before Interest and Taxes).\"\n    *   \"×¨×•×•×— × ×§×™\" (Net profit): Look for \"Net Income,\" \"Net Profit.\"\n    *   \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª\" (Total revenues): Look for \"Total Revenue,\" \"Sales Revenue.\"\n    *   \"×¡×š ×›×œ ×”×”×•×Ÿ\" (Total equity): Look for \"Total Equity,\" \"Shareholders' Equity.\"\n\n2.  **Warning about Potentially Confusing Data:**\n    *   Pay close attention to the specific Hebrew terminology provided in the sheet. Slight variations in source documents (e.g., \"×¨×•×•×— ×’×•×œ××™\" (Gross Profit) vs. \"×¨×•×•×— ×›×•×œ×œ\" (Total Profit/Comprehensive Income)) must be carefully assessed to ensure the correct metric is extracted based on the existing sheet's context.\n    *   Carefully distinguish between \"Cash *for* operating activities\" (positive inflow) and \"Cash *used in* operating activities\" (negative outflow) as both concepts appear in the sheet's labels.\n\n3.  **Units of Measure:**\n    *   The existing sheet displays numerical values in full units (e.g., 17630, 25396). There are no explicit indicators for thousands or millions.\n    *   The AI must extract data from source documents and convert it to full units if the source reports in thousands, millions, or billions (e.g., if a source states \"$17.6M\", it should be extracted as 17,600,000). Ensure consistency across all extracted figures.\n\n4.  **Data Formatting:**\n    *   Numerical values: Extract as raw numerical values. Do not include currency symbols, thousands separators (commas), or extraneous decimal places. The existing sheet uses plain integers.\n    *   Dates: If extracting a reporting period end date (e.g., from \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\"), extract it as a standard date object or in a consistent format like `YYYY-MM-DD` for later processing.\n\n5.  **Irrelevant Data:**\n    *   Any detailed breakdowns of expenses or revenues not specifically identified as key metrics in the B4:C13 block.\n    *   Non-financial footnotes, qualitative descriptions, or management discussion and analysis that do not directly support the extraction of the specified financial metrics.\n    *   Data pertaining to different reporting periods, different entities, or consolidated figures if \"×§×¨×“×Ÿ × ×“×œ×Ÿ\" refers to a specific subsidiary/entity within a larger group, unless the model's scope explicitly allows for such variations."},"description":"×ª×©×•×‘×” ×××•×—×“×ª ××”××•×“×œ: ××›×™×œ×” ×’× ××ª ×”×¡×™×›×•× ×•×’× ××ª ×”×”×•×¨××•×ª.","direction":"UNIFIED_RESPONSE","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_RESPONSE","model":"gemini-2.5-flash","sheetName":"Sheet1","timestamp":"2025-08-12 12:36:35","type":"SHEET_ANALYSIS"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:37:55"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:37:55"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:37:57"}
{"content":{"prompt":"\nYou are an expert financial analyst. Your task is to analyze the provided Google Sheet data and generate a structured response with three distinct sections for different audiences.\n\n**Sheet Name:** Sheet1\n**Sheet Data:**\n```json\n[\n  [\n    {\n      \"value\": \"×‘×¨×§ ×¡×ª×•××§×™\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"×‘×¨×§ ×¡×ª×•××§×™ ××¡ 2\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"3\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"17630\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"25396\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"28764\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×›×•×œ×œ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"112978\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™× \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"97989\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×” \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"39704\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª  \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"84489\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×ª×¤×¢×•×œ×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"48638\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— × ×§×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"572211\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"2336021\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×•×Ÿ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"336382\",\n      \"formula\": \"=AVERAGE(B4:B13)\",\n      \"type\": \"formula\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"336382\",\n      \"formula\": \"=AVERAGE(B4:B13)\",\n      \"type\": \"formula\"\n    }\n  ],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"8\",\n      \"type\": \"literal\"\n    }\n  ]\n]\n```\n\n**YOUR TASK:**\nGenerate a response containing ALL THREE sections below, using the exact headings as specified.\n\n---\n\n### Section 1: User Summary\n- **Goal:** To provide a quick, high-level confirmation to the user that you've understood their financial model.\n- **Audience:** **External.** This will be displayed directly to the end-user in the chat interface. It must be brief (3-4 lines max) and non-technical.\n- **Language:** The summary needs to be written in the primary language of the Google Sheet provided.\n\n### Section 2: AI Editing & Analysis\n- **Goal:** To create a comprehensive technical guide for a future AI agent that will perform edits on this sheet.\n- **Audience:** **Internal Only.** This is a system instruction. Avoid user-facing language.\n- **CRITICAL - Spatial Layout:** Financial models have a visual and spatial structure. Tables are placed above, below, or next to each other for a reason. Your analysis MUST consider this. For example, if adding 10 rows to a \"Projects\" table will overwrite a \"Summary\" table below it, your instructions must explicitly state: \"First, select and move the 'Summary' table down by 10 rows before adding new data to the 'Projects' table.\"\n- **Process:**\n    1.  **High-Level Analysis:** First, describe the sheet's overall structure and data flow. **Crucially, detail the spatial layout by describing the relationships between key tables/blocks (e.g., \"'Projects Table' is in A5:E30, directly above the 'Summary Table' which starts at A35\").** Your analysis must be based **exclusively** on the provided sheet structure. Do not assume standard financial statement layouts if they contradict the provided data.\n    2.  **Specific Instructions:** Based on your analysis, provide a clear, actionable list of editing guidelines. Include what cells are safe to update (inputs), what cells are forbidden (formulas), and explicit warnings about preserving the spatial layout. When your instructions involve adding new rows to an existing table, you must also instruct the AI to analyze the formulas in the calculated columns of that table and replicate their logic for the newly added rows.\n\n### Section 3: Data Extraction Guidelines\n- **Goal:** To create a checklist that will guide the AI in extracting the correct data from future financial documents for this model.\n- **Audience:** **Internal Only.** This is also part of the system instructions.\n- **Content:**\n    - List the key data points to look for.\n    - Warn about potentially confusing data (e.g., \"Look for 'Net Profit attributable to shareholders', not just 'Net Profit'\").\n    - **Units of Measure:** Pay close attention to units (e.g., thousands, millions) in both the source document and the sheet, and ensure consistency.\n    - **Data Formatting:** When extracting numerical or date values, pay close attention to the formatting used in the existing sheet (e.g., currency symbols, decimal separators, date format) and instruct the AI to use the exact same format.\n    - Specify what data is irrelevant to this specific model.\n\n---\n\n**OUTPUT FORMAT:**\n\n### SUMMARY_FOR_USER ###\n(Your 3-4 line summary in the sheet's language goes here)\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n(Your detailed analysis and editing instructions go here)\n\n### DATA_EXTRACTION_GUIDELINES ###\n(Your data extraction checklist goes here)\n"},"description":"×¤×¨×•××¤×˜ ×××•×—×“ ×œ× ×™×ª×•×— ×’×™×œ×™×•×Ÿ: × ×©×œ×— ×œ××•×“×œ ×œ×™×¦×™×¨×ª ×¡×™×›×•× ×•×”×•×¨××•×ª.","direction":"UNIFIED_PROMPT","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_PROMPT","model":"gemini-2.5-flash","sheetName":"Sheet1","timestamp":"2025-08-12 12:38:11","type":"SHEET_ANALYSIS"}
{"content":{"response":"### SUMMARY_FOR_USER ###\n×”××•×“×œ ×©×”×•×’×© × ×¨××” ×›×¡×™×›×•× ××¤×ª×— ×©×œ × ×ª×•× ×™× ×¤×™× × ×¡×™×™×, ×›×’×•×Ÿ ××–×•×× ×™× ××¤×¢×™×œ×•×ª ×©×•×˜×¤×ª, ×¨×•×•×— ×ª×¤×¢×•×œ×™, ×¨×•×•×— × ×§×™, ×”×›× ×¡×•×ª ×•×¡×š ×”×”×•×Ÿ, ×œ×ª××¨×™×š 31 ×‘××¨×¥ 2025. ×”× ×ª×•× ×™× ××•×¦×’×™× ×‘×¤×•×¨××˜ ××¨×•×›×–, ×›××©×¨ ××¡×¤×¨ ×¤×¨×™×˜×™× ××—×•×©×‘×™× ×›×’×•×Ÿ ×¨×•×•×—×™× ×•× ×›×¡×™× ×©×•×˜×¤×™×, ×•×›×Ÿ ×××•×¦×¢ ×©×œ ×—×œ×§ ××”× ×ª×•× ×™× ××•×¦×’ ×‘×ª×—×ª×™×ª.\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n**1. High-Level Analysis & Spatial Layout:**\nThe provided Google Sheet represents a simplified financial overview, likely a summary of key metrics for a single period (March 31, 2025). It does not follow a standard multi-column financial statement layout but rather lists individual financial items.\n\n*   **Header Block (A1:C3):** Contains general information, including a name (\"×‘×¨×§ ×¡×ª×•××§×™\"), model description (\"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\"), and potentially internal identifiers.\n*   **Financial Metrics Block (B4:C13):** This is the core data area. Column B contains numerical values, and Column C contains the Hebrew descriptions of the financial metrics. Each row represents a distinct financial line item (e.g., \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\", \"×¨×•×•×— ×›×•×œ×œ\"). Note that \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" appears twice (B4:C4 and B5:C5) with different values, indicating these should be treated as distinct line items.\n*   **Calculated Summary Block (B15:D15):** Located two rows below the Financial Metrics Block (separated by blank row 14), this block contains aggregate calculations. Specifically, cells B15 and D15 both contain the formula `=AVERAGE(B4:B13)`, calculating the average of the values in the Financial Metrics Block.\n*   **Isolated Value (E17):** Cell E17 contains a single literal value \"8\" with no clear context or relation to the main financial data. It is separated from the Calculated Summary Block by a blank row 16.\n\n**Spatial Relationships:** The Financial Metrics Block (B4:C13) is directly below the Header Block. The Calculated Summary Block (B15:D15) is directly below the Financial Metrics Block, separated by one blank row (R14). The Isolated Value (E17) is below the Calculated Summary Block, separated by one blank row (R16).\n\n**2. Specific Instructions for Editing:**\n\n*   **Input Cells:**\n    *   The values in **B4:B13** are direct financial inputs. These cells are safe to update with new numerical data.\n    *   The descriptions in **C4:C13** are textual inputs. These cells are safe to update to reflect new or corrected metric descriptions.\n    *   The header information in **A1:C3** should only be updated if specifically instructed (e.g., updating the date or model name).\n\n*   **Forbidden Cells (Formulas & Protected Data):**\n    *   **B15 and D15:** These cells contain formulas (`=AVERAGE(B4:B13)`). **DO NOT modify or overwrite these formulas.** Only their calculated results should change as the input data (B4:B13) is updated.\n    *   **E17:** The literal value \"8\" in this cell appears to be an isolated data point without context within this financial model. **DO NOT modify or overwrite this cell** unless its purpose is explicitly clarified and an instruction is given to do so.\n\n*   **Preserving Spatial Layout:**\n    *   **Adding New Financial Metrics:** To add new line items to the Financial Metrics Block, **insert new rows between row 4 and row 13 (inclusive)**. For example, to add a new metric, insert a row at row 10. This will ensure that the existing data shifts down and that the formulas in B15 and D15 automatically adjust their range to include the newly added rows (e.g., `AVERAGE(B4:B14)` if a row is inserted in the middle).\n        *   **Important:** If new rows are added *below* row 13 (i.e., at row 14 or lower), the formulas in B15 and D15 **will NOT** automatically include these new rows. In such a scenario, the AI must explicitly **update the formula ranges** in B15 and D15 to include the newly added rows (e.g., change `=AVERAGE(B4:B13)` to `=AVERAGE(B4:B15)` if a new row is added at row 14).\n    *   **Do not delete rows** within the B4:C13 range without confirming impact on the average calculation.\n    *   Maintain blank rows 14 and 16 to preserve the visual separation between blocks.\n\n*   **Formula Replication:**\n    *   The Financial Metrics Block (B4:C13) currently consists only of input values and labels; there are no calculated columns within this block that require formula replication for new rows.\n    *   The formulas in B15 and D15 are aggregate formulas for the entire block and need to be managed as described above for new rows.\n\n### DATA_EXTRACTION_GUIDELINES ###\nWhen extracting data from source financial documents for this model, the AI should adhere to the following guidelines:\n\n*   **Key Data Points to Extract (Matching C4:C13):**\n    *   \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash for operating activities) - Note this appears twice in the sheet; extract all distinct instances found in source.\n    *   \"×¨×•×•×— ×›×•×œ×œ\" (Total profit / Comprehensive income)\n    *   \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™×\" (Total current assets)\n    *   \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×”\" (Cash and cash equivalents at end of period)\n    *   \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash used in operating activities) - Be aware of the minor typo \"××–×•×× ×™×•×\" and accept \"××–×•×× ×™×\" as a match.\n    *   \"×¨×•×•×— ×ª×¤×¢×•×œ×™\" (Operating profit)\n    *   \"×¨×•×•×— × ×§×™\" (Net profit)\n    *   \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª\" (Total revenues)\n    *   \"×¡×š ×›×œ ×”×”×•×Ÿ\" (Total equity)\n    *   **Header Information:**\n        *   Model Date: \"31 ×‘××¨×¥ 2025\" (Date of the financial model/period end).\n        *   Name/Identifier: \"×‘×¨×§ ×¡×ª×•××§×™\" (Name associated with the model).\n\n*   **Handling Potentially Confusing Data:**\n    *   **Duplicate Descriptions:** As seen in the sheet, \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" might appear multiple times with different values. Extract each instance as a distinct data point if they represent different line items or periods in the source document.\n    *   **Synonyms/Minor Variations:** Be flexible with minor variations or synonyms for the Hebrew labels (e.g., \"×¨×•×•×— ×ª×¤×¢×•×œ×™\" vs. \"×¨×•×•×— ×ª×¤×¢×•×œ×™ ×œ×¤× ×™ ××¡\"). Prioritize exact matches where possible. If ambiguity exists, flag for human review.\n    *   **\"Profit\" vs. \"Net Profit\":** Ensure distinction between \"×¨×•×•×— ×›×•×œ×œ\" (Total profit/Comprehensive Income), \"×¨×•×•×— ×ª×¤×¢×•×œ×™\" (Operating Profit), and \"×¨×•×•×— × ×§×™\" (Net Profit). Extract specific items matching the descriptions in the sheet.\n\n*   **Units of Measure:**\n    *   The sheet displays raw numerical values without explicit units (e.g., thousands, millions).\n    *   When extracting from source documents, assume the numerical values are in the base currency unit (e.g., ILS) unless the source document explicitly states units like '000s (thousands) or 'M (millions). If the source document specifies units (e.g., \"in thousands\"), the AI must convert the extracted value to the base unit before inputting into the sheet (e.g., if source says \"500\" and \"in thousands\", input \"500000\"). If no unit is specified in the source, assume the number is the raw value.\n\n*   **Data Formatting:**\n    *   **Numerical Values:** Extract as plain integers. The sheet does not use currency symbols or decimal separators. Maintain this format for consistency.\n    *   **Text Descriptions:** Extract exact text as it appears in the source, then map to the closest existing description in column C.\n    *   **Dates:** Extract dates in \"Day Month Year\" format (e.g., \"31 ×‘××¨×¥ 2025\").\n\n*   **Irrelevant Data:**\n    *   Any numerical values or text that do not correspond to the specific financial metrics listed in C4:C13 or the header information (date, name).\n    *   Footnotes, disclaimers, or explanatory text not directly tied to a specific metric's value.\n    *   Formulas or internal calculations from the source document (only the result/value is needed).\n    *   The isolated value \"8\" in E17 should be ignored for data extraction purposes unless its meaning and intended source are explicitly clarified."},"description":"×ª×©×•×‘×” ×××•×—×“×ª ××”××•×“×œ: ××›×™×œ×” ×’× ××ª ×”×¡×™×›×•× ×•×’× ××ª ×”×”×•×¨××•×ª.","direction":"UNIFIED_RESPONSE","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_RESPONSE","model":"gemini-2.5-flash","sheetName":"Sheet1","timestamp":"2025-08-12 12:38:34","type":"SHEET_ANALYSIS"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:39:30"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:39:30"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:39:34"}
{"content":{"prompt":"\nYou are an expert financial analyst. Your task is to analyze the provided Google Sheet data and generate a structured response with three distinct sections for different audiences.\n\n**Sheet Name:** Sheet1\n**Sheet Data:**\n```json\n[\n  [\n    {\n      \"value\": \"×‘×¨×§ ×¡×ª×•××§×™\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"×‘×¨×§ ×¡×ª×•××§×™ ××¡ 2\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"5\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"3\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"17630\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"25396\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"28764\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×›×•×œ×œ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"112978\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™× \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"97989\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×” \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"39704\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª  \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"84489\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×ª×¤×¢×•×œ×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"48638\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— × ×§×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"572211\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"2336021\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×•×Ÿ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"336382\",\n      \"formula\": \"=AVERAGE(B4:B13)\",\n      \"type\": \"formula\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"336382\",\n      \"formula\": \"=AVERAGE(B4:B13)\",\n      \"type\": \"formula\"\n    }\n  ],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"8\",\n      \"type\": \"literal\"\n    }\n  ]\n]\n```\n\n**YOUR TASK:**\nGenerate a response containing ALL THREE sections below, using the exact headings as specified.\n\n---\n\n### Section 1: User Summary\n- **Goal:** To provide a quick, high-level confirmation to the user that you've understood their financial model.\n- **Audience:** **External.** This will be displayed directly to the end-user in the chat interface. It must be brief (3-4 lines max) and non-technical.\n- **Language:** The summary needs to be written in the primary language of the Google Sheet provided.\n\n### Section 2: AI Editing & Analysis\n- **Goal:** To create a comprehensive technical guide for a future AI agent that will perform edits on this sheet.\n- **Audience:** **Internal Only.** This is a system instruction. Avoid user-facing language.\n- **CRITICAL - Spatial Layout:** Financial models have a visual and spatial structure. Tables are placed above, below, or next to each other for a reason. Your analysis MUST consider this. For example, if adding 10 rows to a \"Projects\" table will overwrite a \"Summary\" table below it, your instructions must explicitly state: \"First, select and move the 'Summary' table down by 10 rows before adding new data to the 'Projects' table.\"\n- **Process:**\n    1.  **High-Level Analysis:** First, describe the sheet's overall structure and data flow. **Crucially, detail the spatial layout by describing the relationships between key tables/blocks (e.g., \"'Projects Table' is in A5:E30, directly above the 'Summary Table' which starts at A35\").** Your analysis must be based **exclusively** on the provided sheet structure. Do not assume standard financial statement layouts if they contradict the provided data.\n    2.  **Specific Instructions:** Based on your analysis, provide a clear, actionable list of editing guidelines. Include what cells are safe to update (inputs), what cells are forbidden (formulas), and explicit warnings about preserving the spatial layout. When your instructions involve adding new rows to an existing table, you must also instruct the AI to analyze the formulas in the calculated columns of that table and replicate their logic for the newly added rows.\n\n### Section 3: Data Extraction Guidelines\n- **Goal:** To create a checklist that will guide the AI in extracting the correct data from future financial documents for this model.\n- **Audience:** **Internal Only.** This is also part of the system instructions.\n- **Content:**\n    - List the key data points to look for.\n    - Warn about potentially confusing data (e.g., \"Look for 'Net Profit attributable to shareholders', not just 'Net Profit'\").\n    - **Units of Measure:** Pay close attention to units (e.g., thousands, millions) in both the source document and the sheet, and ensure consistency.\n    - **Data Formatting:** When extracting numerical or date values, pay close attention to the formatting used in the existing sheet (e.g., currency symbols, decimal separators, date format) and instruct the AI to use the exact same format.\n    - Specify what data is irrelevant to this specific model.\n\n---\n\n**OUTPUT FORMAT:**\n\n### SUMMARY_FOR_USER ###\n(Your 3-4 line summary in the sheet's language goes here)\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n(Your detailed analysis and editing instructions go here)\n\n### DATA_EXTRACTION_GUIDELINES ###\n(Your data extraction checklist goes here)\n"},"description":"×¤×¨×•××¤×˜ ×××•×—×“ ×œ× ×™×ª×•×— ×’×™×œ×™×•×Ÿ: × ×©×œ×— ×œ××•×“×œ ×œ×™×¦×™×¨×ª ×¡×™×›×•× ×•×”×•×¨××•×ª.","direction":"UNIFIED_PROMPT","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_PROMPT","model":"gemini-2.5-flash","sheetName":"Sheet1","timestamp":"2025-08-12 12:40:01","type":"SHEET_ANALYSIS"}
{"content":{"response":"### SUMMARY_FOR_USER ###\n×”×‘× ×ª×™ ×›×™ ×”×“××˜×” ×©×”×•×¦×’×” ××¤×¨×˜×ª × ×ª×•× ×™ ××¤×ª×— ×¤×™× × ×¡×™×™× ×©×œ ××•×“×œ ×§×¨×“×Ÿ × ×“×œ\"×Ÿ ×œ×ª××¨×™×š 31 ×‘××¨×¥ 2025. ×”× ×ª×•× ×™× ×›×•×œ×œ×™× ××“×“×™× ×—×©×•×‘×™× ×›××• ××–×•×× ×™×, ×¨×•×•×—×™× ×•× ×›×¡×™×, ×•××¡×•×›××™× ×‘×××•×¦×¢ ×—×©×‘×•× ×™ ×‘×¡×•×£ ×”×¨×©×™××”.\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n**High-Level Analysis:**\nThis Google Sheet represents a simplified financial model for \"Kardan Real Estate\" as of March 31, 2025. Its primary function appears to be a snapshot or listing of key financial metrics.\n*   **Header Information:** Rows 1-3 contain general identifying information and standalone numbers, such as \"×‘×¨×§ ×¡×ª×•××§×™\" (Barak Stomki) and \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\" (Kardan Real Estate Model March 31, 2025). These serve as context but are not part of the core financial data block.\n*   **Main Data Block:** The core financial data resides in cells `B4:C13`. Column C contains Hebrew labels for various financial line items (e.g., Cash, Profits, Assets), and Column B contains their corresponding numerical values. This block is essentially a vertical list of key financial metrics.\n*   **Summary Calculation:** Immediately below the main data block, in Row 15, there are two cells (`B15` and `D15`) that calculate the `AVERAGE` of the numerical values in the main data block (`B4:B13`). This row is physically separated by an empty row (Row 14).\n*   **Miscellaneous:** Row 17 contains a standalone number in cell `E17`.\n\n**Spatial Layout:**\n*   The primary descriptive headers/titles are located in `A1:C1` and `A2:E2`.\n*   The main financial data is structured as a two-column list starting at `B4`.\n*   The calculated `AVERAGE` values in `B15` and `D15` are positioned directly below the main data block, separated by an empty row (Row 14).\n*   There's also an isolated numerical value in `A3` and `E17`.\n\n**Specific Editing Guidelines:**\n1.  **Input Data Cells:**\n    *   Values in `B4:B13` are considered inputs. These can be updated with new financial figures.\n    *   Labels in `C4:C13` are descriptive inputs and can be updated to reflect new or corrected financial line item names.\n2.  **Forbidden/Formula Cells:**\n    *   Cells `B15` and `D15` contain formulas (`=AVERAGE(B4:B13)`). These cells must NOT be directly edited or overwritten. Their values are derived from the input data.\n3.  **Preserving Spatial Layout and Formula Integrity when Adding Data:**\n    *   **Adding New Financial Line Items:** To add new financial data points, rows must be inserted immediately below the last existing data row (currently row 13).\n        *   **Action:** Select row 14 (the empty row) and insert new rows (e.g., 1 or more) *above* it. This will push down the empty row 14, the average calculation row 15, and subsequent rows.\n        *   **Formula Adjustment:** After inserting 'N' new rows, the average formulas in `B15` and `D15` (which would now be `B(15+N)` and `D(15+N)`) must be updated to include the newly added data. Specifically, their range should expand from `AVERAGE(B4:B13)` to `AVERAGE(B4:B(13+N))`. The AI must explicitly adjust the formula's range to encompass all new entries in Column B.\n    *   **Maintaining Header and Footer Integrity:** The header information (Rows 1-3) and the isolated number in `E17` must remain in their current relative positions. Avoid inserting rows or columns that would disrupt these static elements unless explicitly instructed.\n4.  **Data Consistency:** When updating or adding data, ensure that values in Column B are purely numerical and labels in Column C are text.\n\n### DATA_EXTRACTION_GUIDELINES ###\nThis section outlines the data points to extract from source financial documents for input into this model.\n\n1.  **Key Financial Metrics (to populate Column B in the model):**\n    *   **Cash and Cash Equivalents:**\n        *   \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash for Operating Activities) - Extract for *all* instances found, as multiple different values for this label exist in the sheet.\n        *   \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×”\" (Cash and Cash Equivalents at End of Period).\n        *   \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\" (Cash from Activities Used for Operating Activities - *Note the potential typo '××–×•×× ×™×•×', extract as '××–×•×× ×™×' or exact as found).\n    *   **Profitability Metrics:**\n        *   \"×¨×•×•×— ×›×•×œ×œ\" (Total Profit / Gross Profit).\n        *   \"×¨×•×•×— ×ª×¤×¢×•×œ×™\" (Operating Profit).\n        *   \"×¨×•×•×— × ×§×™\" (Net Profit).\n    *   **Assets & Capital:**\n        *   \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™×\" (Total Current Assets).\n        *   \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª\" (Total Revenues).\n        *   \"×¡×š ×›×œ ×”×”×•×Ÿ\" (Total Capital / Total Equity).\n\n2.  **Units of Measure:**\n    *   Assume numbers are in absolute values (not thousands or millions) unless explicitly stated otherwise in the source document (e.g., \"×‘××œ×¤×™ ×©×§×œ×™× ×—×“×©×™×\" - in thousands of NIS). If units are specified in the source, convert to the model's assumed base unit (no explicit unit indicated in sheet, implying absolute values).\n    *   Extract numerical values without currency symbols (e.g., \"â‚ª\", \"$\").\n\n3.  **Data Formatting:**\n    *   Extract numerical values as plain numbers (integers), matching the current sheet's format (no decimals observed).\n    *   Do not include thousands separators (e.g., commas).\n\n4.  **Warnings/Specific Instructions:**\n    *   **Duplicate Labels:** Be aware that the same label (e.g., \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\") may appear multiple times with different values. Extract each instance as a distinct line item as per the existing sheet's structure. Do not consolidate them unless a clear distinction (e.g., \"period 1\" vs. \"period 2\") is present in the source that requires such consolidation.\n    *   **Label Matching:** Pay close attention to exact Hebrew phrasing for financial line items. If a slightly different phrasing is found (e.g., \"×¨×•×•×— × ×§×™ ×œ×ª×§×•×¤×”\" vs. \"×¨×•×•×— × ×§×™\"), consider if it represents the same metric or a distinct one. Prioritize exact matches where possible, otherwise flag for human review.\n\n5.  **Irrelevant Data:**\n    *   Ignore personal names (e.g., \"×‘×¨×§ ×¡×ª×•××§×™\") or generic model identifiers (e.g., \"××¡ 2\", \"3\", \"5\", \"8\").\n    *   Ignore dates that are part of the model title but not tied to specific financial entries (e.g., \"31 ×‘××¨×¥ 2025\" in the header, unless specific historical data is required for that date).\n    *   Ignore any text or numbers that are not clearly linked to a financial metric as per the structure of `B4:C13`."},"description":"×ª×©×•×‘×” ×××•×—×“×ª ××”××•×“×œ: ××›×™×œ×” ×’× ××ª ×”×¡×™×›×•× ×•×’× ××ª ×”×”×•×¨××•×ª.","direction":"UNIFIED_RESPONSE","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_RESPONSE","model":"gemini-2.5-flash","sheetName":"Sheet1","timestamp":"2025-08-12 12:40:25","type":"SHEET_ANALYSIS"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 12:43:45"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 12:43:45"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 12:43:47"}
{"content":{"prompt":"\nYou are an expert financial analyst. Your task is to analyze the provided Google Sheet data and generate a structured response with three distinct sections for different audiences.\n\n**Sheet Name:** Sheet1\n**Sheet Data:**\n```json\n[\n  [\n    {\n      \"value\": \"×‘×¨×§ ×¡×ª×•××§×™\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××•×“×œ ×§×¨×“×Ÿ × ×“×œ×Ÿ 31 ×‘××¨×¥ 2025\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"×‘×¨×§ ×¡×ª×•××§×™ ××¡ 2\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"5\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"3\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"17630\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"5\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"25396\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"28764\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×›×•×œ×œ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"112978\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™× \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"97989\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×™×ª×¨×ª ××–×•×× ×™× ×•×©×•×•×™ ××–×•×× ×™× ×œ×¡×•×£ ×”×ª×§×•×¤×” \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"39704\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"××–×•×× ×™×•× ××¤×¢×™×œ×•×ª ×©×©×™××©×• ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª  \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"84489\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— ×ª×¤×¢×•×œ×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"48638\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¨×•×•×— × ×§×™ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"572211\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª \",\n      \"type\": \"literal\"\n    }\n  ],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"2336021\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"×¡×š ×›×œ ×”×”×•×Ÿ \",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"#DIV/0!\",\n      \"formula\": \"=AVERAGE(E4:E13)\",\n      \"type\": \"formula\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"#DIV/0!\",\n      \"formula\": \"=AVERAGE(E4:E13)\",\n      \"type\": \"formula\"\n    }\n  ],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"8\",\n      \"type\": \"literal\"\n    }\n  ],\n  [],\n  [\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"\",\n      \"type\": \"literal\"\n    },\n    {\n      \"value\": \"8\",\n      \"formula\": \"=AVERAGE(E1:E18)\",\n      \"type\": \"formula\"\n    }\n  ]\n]\n```\n\n**YOUR TASK:**\nGenerate a response containing ALL THREE sections below, using the exact headings as specified.\n\n---\n\n### Section 1: User Summary\n- **Goal:** To provide a quick, high-level confirmation to the user that you've understood their financial model.\n- **Audience:** **External.** This will be displayed directly to the end-user in the chat interface. It must be brief (3-4 lines max) and non-technical.\n- **Language:** The summary needs to be written in the primary language of the Google Sheet provided.\n\n### Section 2: AI Editing & Analysis\n- **Goal:** To create a comprehensive technical guide for a future AI agent that will perform edits on this sheet.\n- **Audience:** **Internal Only.** This is a system instruction. Avoid user-facing language.\n- **CRITICAL - Spatial Layout:** Financial models have a visual and spatial structure. Tables are placed above, below, or next to each other for a reason. Your analysis MUST consider this. For example, if adding 10 rows to a \"Projects\" table will overwrite a \"Summary\" table below it, your instructions must explicitly state: \"First, select and move the 'Summary' table down by 10 rows before adding new data to the 'Projects' table.\"\n- **Process:**\n    1.  **High-Level Analysis:** First, describe the sheet's overall structure and data flow. **Crucially, detail the spatial layout by describing the relationships between key tables/blocks (e.g., \"'Projects Table' is in A5:E30, directly above the 'Summary Table' which starts at A35\").** Your analysis must be based **exclusively** on the provided sheet structure. Do not assume standard financial statement layouts if they contradict the provided data.\n    2.  **Specific Instructions:** Based on your analysis, provide a clear, actionable list of editing guidelines. Include what cells are safe to update (inputs), what cells are forbidden (formulas), and explicit warnings about preserving the spatial layout. When your instructions involve adding new rows to an existing table, you must also instruct the AI to analyze the formulas in the calculated columns of that table and replicate their logic for the newly added rows.\n\n### Section 3: Data Extraction Guidelines\n- **Goal:** To create a checklist that will guide the AI in extracting the correct data from future financial documents for this model.\n- **Audience:** **Internal Only.** This is also part of the system instructions.\n- **Content:**\n    - List the key data points to look for.\n    - Warn about potentially confusing data (e.g., \"Look for 'Net Profit attributable to shareholders', not just 'Net Profit'\").\n    - **Units of Measure:** Pay close attention to units (e.g., thousands, millions) in both the source document and the sheet, and ensure consistency.\n    - **Data Formatting:** When extracting numerical or date values, pay close attention to the formatting used in the existing sheet (e.g., currency symbols, decimal separators, date format) and instruct the AI to use the exact same format.\n    - Specify what data is irrelevant to this specific model.\n\n---\n\n**OUTPUT FORMAT:**\n\n### SUMMARY_FOR_USER ###\n(Your 3-4 line summary in the sheet's language goes here)\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n(Your detailed analysis and editing instructions go here)\n\n### DATA_EXTRACTION_GUIDELINES ###\n(Your data extraction checklist goes here)\n"},"description":"×¤×¨×•××¤×˜ ×××•×—×“ ×œ× ×™×ª×•×— ×’×™×œ×™×•×Ÿ: × ×©×œ×— ×œ××•×“×œ ×œ×™×¦×™×¨×ª ×¡×™×›×•× ×•×”×•×¨××•×ª.","direction":"UNIFIED_PROMPT","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_PROMPT","model":"gemini-2.5-flash","sheetName":"Sheet1","timestamp":"2025-08-12 12:44:04","type":"SHEET_ANALYSIS"}
{"content":{"response":"### SUMMARY_FOR_USER ###\n×’×™×œ×™×•×Ÿ ×–×” × ×¨××” ×›××•×“×œ ×¤×™× × ×¡×™ ××• ×¡×™×›×•× ×¢×‘×•×¨ '×§×¨×“×Ÿ × ×“×œ\"×Ÿ', ×”××ª×™×™×—×¡ ×œ×ª××¨×™×š 31 ×‘××¨×¥ 2025.\n×”×•× ×›×•×œ×œ ××“×“×™× ×¤×™× × ×¡×™×™× ×©×•× ×™× ×›×’×•×Ÿ ×”×›× ×¡×•×ª, ×¨×•×•×—×™×, ×ª×–×¨×™××™ ××–×•×× ×™× ×•× ×ª×•× ×™× ××”×××–×Ÿ.\n×”××•×“×œ ××›×™×œ ×’× ×©×“×•×ª ××—×•×©×‘×™× ×”××‘×•×¡×¡×™× ×¢×œ ×”× ×ª×•× ×™× ×©×”×•×–× ×•.\n\n### EDITING_INSTRUCTIONS_FOR_AI ###\n**High-Level Analysis & Spatial Layout:**\nThe Google Sheet is structured vertically, presenting financial metrics and some summary calculations.\n1.  **Header Block (A1:E3):** Contains descriptive information such as the model name, company (\"Kardan Real Estate\"), date (\"March 31, 2025\"), and author (\"Barak Stumki\"). Cells E2 and A3 contain isolated literal values ('5' and '3' respectively) which appear to be part of this initial setup.\n2.  **Main Financial Metrics Block (A4:E13):** This is the core data area.\n    *   Column B (B4:B13) contains the primary numerical values for various financial metrics.\n    *   Column C (C4:C13) contains the Hebrew descriptions of these metrics.\n    *   Column E (E4:E5) contains sporadic literal values ('5'), which are referenced by later formulas, suggesting they are inputs or parameters for specific calculations. The rest of Column E in this block is empty.\n3.  **Intermediate Calculation Block (B15:D15):** This block is located directly below the Main Financial Metrics Block and is separated by one empty row (Row 14). It contains two formulaic cells (B15, D15) that calculate the average of values in Column E from the Main Financial Metrics Block.\n4.  **Bottom Calculation Block (E17:E19):** This block is further below, separated by empty rows (Rows 16, 18). It contains a literal value (E17: '8') and a formulaic cell (E19) that calculates an average across a very broad range of cells in Column E.\n\nThe spatial layout is simple: Header at the top, followed by the main data block, then two smaller calculation blocks below it. All blocks are vertically aligned.\n\n**Specific Instructions for Editing:**\n*   **Safe-to-Update Cells (Inputs):**\n    *   Cells in Column B (B4:B13) are direct numerical inputs for financial metrics.\n    *   Cells in Column C (C4:C13) are text descriptions and can be updated to reflect new metric names.\n    *   Cells E4, E5, and E17 are literal inputs and can be updated as needed.\n*   **Forbidden-to-Edit Cells (Formulas):**\n    *   Cells B15, D15 (formulas: `=AVERAGE(E4:E13)`).\n    *   Cell E19 (formula: `=AVERAGE(E1:E18)`).\n    *   These cells contain formulas and their values are calculated. Do not manually enter values into these cells.\n*   **Preserving Spatial Layout & Adding New Data:**\n    1.  **Adding New Financial Metrics:** If new financial metrics need to be added to the Main Financial Metrics Block (A4:E13), insert new rows *before* Row 14 (i.e., between Row 13 and Row 14).\n    2.  **Moving Dependent Blocks:** For every new row inserted into the Main Financial Metrics Block:\n        *   Select and move the entire \"Intermediate Calculation Block\" (B15:D15) downwards by the number of inserted rows.\n        *   Select and move the entire \"Bottom Calculation Block\" (E17:E19) downwards by the number of inserted rows.\n    3.  **Extending Formula Ranges:** After adding new rows and populating columns B and C (and potentially E) in the Main Financial Metrics Block:\n        *   Update the range in the formulas in B15 and D15 (`=AVERAGE(E4:E13)`). Extend the end row of the range to include the newly added rows (e.g., if 3 rows are added, update to `=AVERAGE(E4:E16)`).\n        *   Update the range in the formula in E19 (`=AVERAGE(E1:E18)`). Extend the end row of the range to include any newly added rows that might contain numeric values in Column E (e.g., if 3 rows are added, update to `=AVERAGE(E1:E21)`).\n    4.  **Formula Replication:** There are no formulas within the Main Financial Metrics Block (A4:E13) itself that need replication for new rows. Column E currently contains only literal values ('5' in E4, E5). If new rows are added, and if future data dictates that Column E should contain a specific formula based on other columns, the AI should then analyze and replicate that formula's logic. Based on the current sheet, this specific instruction is not applicable to the main data input columns.\n\n### DATA_EXTRACTION_GUIDELINES ###\n**Key Data Points to Extract:**\n*   **Company Name & Model Date:**\n    *   Extract the company name (e.g., \"×§×¨×“×Ÿ × ×“×œ×Ÿ\") and the associated date (e.g., \"31 ×‘××¨×¥ 2025\") from the top header section, specifically cell C1.\n*   **Financial Metrics and Values:**\n    *   For each entry in the \"Main Financial Metrics Block\" (rows 4-13):\n        *   Extract the exact Hebrew description from Column C (e.g., \"××–×•×× ×™× ×œ×¤×¢×™×œ×•×ª ×©×•×˜×¤×ª\", \"×¨×•×•×— ×›×•×œ×œ\", \"×¡×š × ×›×¡×™× ×©×•×˜×¤×™×\", \"×¨×•×•×— ×ª×¤×¢×•×œ×™\", \"×¨×•×•×— × ×§×™\", \"×¡×š ×›×œ ×”×”×›× ×¡×•×ª\", \"×¡×š ×›×œ ×”×”×•×Ÿ\").\n        *   Extract the corresponding numerical value from Column B.\n    *   Extract specific numerical values from Column E (E4, E5) and E17, even if their exact purpose isn't immediately clear, as they are used in sheet calculations.\n\n**Warnings about Potentially Confusing Data:**\n*   **Exact Phrasing:** Pay extremely close attention to the exact phrasing of financial metric descriptions in Hebrew. Slight variations (e.g., \"Cash from operating activities\" vs. \"Cash used in operating activities\") can represent different line items. Match precisely to the terms in Column C.\n*   **Contextual Numbers:** Be aware that isolated numbers like '5' (E2, E4, E5) and '3' (A3) or '8' (E17) may represent specific parameters or period identifiers rather than general financial figures. Extract them as such.\n\n**Units of Measure & Data Formatting:**\n*   **Numerical Values:**\n    *   The numbers in Column B (and E) are presented as large integers without decimal places or currency symbols.\n    *   Extract all numerical values as raw numbers (e.g., `17630` as `17630`, not `17,630` or `17.63`).\n    *   Assume absolute values (not thousands or millions) unless an explicit \"in thousands\" or \"in millions\" indicator is found directly accompanying the values or in the document's general notes.\n*   **Date Formatting:**\n    *   The date in C1 (\"31 ×‘××¨×¥ 2025\") should be extracted in \"DD Month YYYY\" format (e.g., \"March 31, 2025\") or parsed to a standard date object suitable for system use.\n*   **Text Descriptions:**\n    *   Extract text descriptions (Column C) verbatim, maintaining their exact Hebrew spelling and spacing.\n\n**Irrelevant Data for this Model:**\n*   Any introductory or concluding paragraphs, disclaimers, or footnotes that are not directly associated with the specific financial metrics listed.\n*   Any non-financial data points (e.g., operational metrics, employee counts, non-monetary statistics) unless explicitly requested and matched to a new row in the model.\n*   Any financial line items that do not have a corresponding description in the existing Column C of the sheet, unless instructed to add new line items."},"description":"×ª×©×•×‘×” ×××•×—×“×ª ××”××•×“×œ: ××›×™×œ×” ×’× ××ª ×”×¡×™×›×•× ×•×’× ××ª ×”×”×•×¨××•×ª.","direction":"UNIFIED_RESPONSE","level":"info","message":"ğŸ“ SHEET_ANALYSIS UNIFIED_RESPONSE","model":"gemini-2.5-flash","sheetName":"Sheet1","timestamp":"2025-08-12 12:44:36","type":"SHEET_ANALYSIS"}
{"level":"info","message":"ğŸ”¥ Winston logging system initialized - All detailed logs saved to logs/ directory","timestamp":"2025-08-12 15:29:48"}
{"level":"info","message":"ğŸ”— Attempting to connect to MongoDB...","timestamp":"2025-08-12 15:29:48"}
{"level":"info","message":"ğŸƒ Connected to MongoDB successfully","timestamp":"2025-08-12 15:29:49"}
